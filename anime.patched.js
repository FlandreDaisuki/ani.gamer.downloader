/**
 * Modified from https://i2.bahamut.com.tw/js/anime.js?v=1521704076
 * by FlandreDaisuki
**/
!function(e,t,n){function a(){return this instanceof a?this.init():new a}function o(){return jQuery.ajax({url:"/ajax/getCSRFToken.php",cache:!1})}function r(e){e=Math.floor(e/10);var t=Math.floor(e/3600),n=Math.floor((e-3600*t)/60),a=Math.floor(e-3600*t-60*n);return 10>n&&(n="0"+n),10>a&&(a="0"+a),t+":"+n+":"+a}function i(){try{return e.localStorage.setItem("teehee","teehee"),e.localStorage.removeItem("teehee"),!0}catch(t){return!1}}function d(e,t,n){var a=e.getElementsByTagName("errMsg"),o=e.getElementsByTagName("okMsg");a.length?(msg=a[0].firstChild.nodeValue,egg.mutbox(msg," ")):o.length&&(jQuery(n).hasClass("newanime__order")?jQuery(n).addClass("is-order"):"button"==jQuery(n).prop("nodeName").toLowerCase()?jQuery(n).addClass("ordered"):jQuery(n).addClass("yes"),jQuery(n).attr("onclick","animefun.delgather("+t+",this)"),egg.mutbox("已將作品加入至我的動畫！"," "))}function s(e,t,n){t.error?egg.mutbox(t.msg," "):(jQuery(n).hasClass("ordered")?jQuery(n).removeClass("ordered"):jQuery(n).hasClass("is-order")?jQuery(n).removeClass("is-order"):jQuery(n).removeClass("yes"),jQuery(n).attr("onclick","animefun.want2play("+e+",this)"),egg.mutbox("已將作品從我的動畫中移除！"," "))}var u;a.prototype.init=function(){this.videoSn="",this.danmu="",this.danmucolor="#FFFFFF",this.danmusize=1,this.danmuposition=0,this.stopscroll=!1,this.keywords=""},a.prototype.setdanmusize=function(e,t){jQuery(".bullet-control-size").find("button").removeClass("select"),jQuery(t).addClass("select"),this.danmusize=e},a.prototype.setdanmucolor=function(e,t){jQuery(".bullet-control-color").find("button").removeClass("select"),jQuery(t).addClass("select"),this.danmucolor=e},a.prototype.setdanmuposition=function(e,t){jQuery(".bullet-control-position").find("button").removeClass("select"),jQuery(t).addClass("select"),this.danmuposition=e},a.prototype.want2play=function(e,t){return jQuery.ajax({url:"/ajax/want2play.php",data:{s:e},method:"GET"}).done(function(n){d(n,e,t)}),!1},a.prototype.delgather=function(e,t){o().done(function(n){jQuery.ajax({url:"/ajax/delgather.php",data:{s:e,token:n},method:"POST",dataType:"json"}).done(function(n){s(e,n,t)})})},a.prototype.gathertip=function(){1!=localStorage.getItem("ANIME_gathertip")&&(egg.lightbox.close(),egg.mutbox("這裡與小屋中的遊戲動漫櫃同步，顯示你曾加入過並在動畫瘋上架的動畫作品！"," ",{"好，我了解了":function(){localStorage.setItem("ANIME_gathertip",1),egg.lightbox.close()}},{closeButton:!1}))},a.prototype.getdeviceid=function(){return localStorage.getItem("ANIME_deviceid")},a.prototype.checkdeviceid=function(){jQuery.ajax({url:"/ajax/getdeviceid.php",data:{id:localStorage.getItem("ANIME_deviceid")},method:"GET",dataType:"json"}).done(function(e){e.deviceid&&animefun.setStorageItem("ANIME_deviceid",e.deviceid)})},a.prototype.renderSublist=function(){var e=0,t=function(){var t=animefun,n=40*(t.danmu.length+1),a=jQuery("#sub_list").scrollTop();if(Math.abs(e-a)>=160){var o=a-200>=0?a-200:0,i=n>=a+600?a+600:n,d=0==Math.ceil(o/40)?0:Math.ceil(o/40)-1,s=Math.ceil(i/40)>=t.danmu.length?t.danmu.length-1:Math.ceil(i/40)-1,u=o-0,l=n-i;jQuery("#sub_list").empty(),u>0&&jQuery("#sub_list").append('<div style="height:'+u+'px;"></div>');var c=t.danmu.length>3e3?"3000+":t.danmu.length;jQuery("#sub_list").append('<li><div style="font-size:1.5em;padding-top:0.8em;padding-bottom:0.7em;"><i class="material-icons">info_outline</i> 本動畫共 '+c+" 筆彈幕</div></li>");for(var m=d;s>=m;m++)jQuery("#sub_list").append("<li><div><b>"+r(t.danmu[m].time)+'</b><div id="danmu'+t.danmu[m].sn+'" class="sub_content"></div></div><div><button class="edit" onclick="jQuery(\'#danmutxt\').val(jQuery(\'#danmu'+t.danmu[m].sn+'\').text())">複製</button><button class="edit" onclick="animefun.blackUid(\''+t.danmu[m].userid+"', "+t.videoSn+')">消音</button><button class="edit" onclick="animefun.accusedanmu('+t.danmu[m].sn+')">檢舉</button><div class="name">ID <span>'+t.danmu[m].userid+"</span></div></div></li>"),jQuery("#danmu"+t.danmu[m].sn).text(t.danmu[m].text);jQuery("#sub_list").append('<div style="height:'+l+'px;"></div>'),e=a}};return t},a.prototype.addkeyword=function(){var e=animefun,t=$(".ani-keyword-label").length;if(t>=50)return alert("不得超過50組關鍵字"),!1;var n=$("#newkeyword").val();return 0==n.length?(alert("請輸入關鍵字"),!1):n.length>90?(alert("關鍵字不得超過30字"),!1):($.ajax({url:"/ajax/getCSRFToken.php",cache:!1}).done(function(t){$.ajax({url:"/ajax/keywordSet.php",method:"POST",data:{token:t,action:"add",keyword:n},dataType:"json"}).done(function(t){if(0==t.code)alert(t.message);else if(1==t.code){var n='<span class="ani-keyword-label">';n=n+"<span>"+t.keyword+"</span>",n=n+'<a href="#" data-keyword-id="'+t.message+'" class="ani-keyword-close" onclick="animefun.delkeyword(this);"><i class="material-icons">close</i></a>',n+="</span>",$(".ani-keyword-body").append(n),$("#newkeyword").val(""),e.refreshdanmu()}else 2==t.code?egg.mutbox("請先登入"," ",{"前往登入":function(){location.href="https://user.gamer.com.tw/login.php"}},{closeButton:!0,closeTrigger:"none"}):alert("新增失敗")})}),!1)},a.prototype.delkeyword=function(e){var t=animefun,n=$(e).data("keyword-id");return $.ajax({url:"/ajax/getCSRFToken.php",cache:!1}).done(function(a){$.ajax({url:"/ajax/keywordSet.php",method:"POST",data:{token:a,action:"del",sn:n}}).done(function(n){$(e).parent(".ani-keyword-label").remove(),t.refreshdanmu()})}),!1},a.prototype.getkeywords=function(){var e=animefun;""==e.keywords&&jQuery.ajax({url:"/ajax/keywordGet.php",method:"GET",dataType:"json"}).done(function(t){if(t.length){e.keywords=t;for(var n in e.keywords){var a=e.keywords[n],o='<span class="ani-keyword-label">';o=o+"<span>"+a.keyword+"</span>",o=o+'<a href="#" data-keyword-id="'+a.sn+'" class="ani-keyword-close" onclick="animefun.delkeyword(this);"><i class="material-icons">close</i></a>',o+="</span>",jQuery(".ani-keyword-body").append(o)}}})},a.prototype.getdanmu=function(){var e=animefun;""==e.danmu&&jQuery.ajax({url:"/ajax/danmuGet.php",data:{sn:e.videoSn},method:"POST",dataType:"json"}).done(function(t){if(t.error)return 1!=t.nologin&&egg.mutbox(t.msg," "),void(e.danmu="");if(jQuery("#sub_list").html(""),t.length){e.danmu=t,jQuery("#sub_list").removeClass("no_sub").addClass("sub_list"),jQuery("#danmuCount").html("("+t.length+")");var n=t.length>3e3?"3000+":t.length;jQuery("#sub_list").append('<li><div style="font-size:1.5em;padding-top:0.8em;padding-bottom:0.7em;"><i class="material-icons">info_outline</i> 本動畫共 '+n+" 筆彈幕</div></li>");for(var a in e.danmu){if(a>=50){jQuery("#sub_list").append('<div style="height:'+40*(e.danmu.length-49)+'px;"></div>');break}jQuery("#sub_list").append("<li><div><b>"+r(e.danmu[a].time)+'</b><div id="danmu'+e.danmu[a].sn+'" class="sub_content"></div></div><div><button class="edit" onclick="jQuery(\'#danmutxt\').val(jQuery(\'#danmu'+e.danmu[a].sn+'\').text())">複製</button><button class="edit" onclick="animefun.blackUid(\''+e.danmu[a].userid+"', "+e.videoSn+')">消音</button><button class="edit" onclick="animefun.accusedanmu('+e.danmu[a].sn+')">檢舉</button><div class="name">ID <span>'+e.danmu[a].userid+"</span></div></div></li>"),jQuery("#danmu"+e.danmu[a].sn).text(e.danmu[a].text)}}else jQuery("#sub_list").removeClass("sub_list").addClass("no_sub").html("<img src='https://i2.bahamut.com.tw/anime/no_sub.png'><br>目前沒有彈幕喔！<br>發個彈幕搶頭香吧！")});var t=e.renderSublist();return t(),!1},a.prototype.refreshdanmu=function(){var e=animefun;e.danmu="",e.getdanmu(),setTimeout(function(){try{e.updatedanmu()}catch(t){}},1e3)},a.prototype.setdanmu=function(e){if(!animefun.danmu_status)return jQuery("#danmutxt").val("").attr("placeholder","系統預備中"),jQuery("#danmuturn").attr("disabled",!0),void jQuery("#animeTip").show();if(""==e)return void alert("沒有內容?");if(40<jQuery("#danmutxt").val().length)return void alert("不得超過40字");var t=animefun,n=animefun.danmu_time,a=10*animefun.gettotaltime();return n>a?void alert("彈幕時間錯誤"):(jQuery("#danmutxt").val("").attr("placeholder","已送出"),void o().done(function(a){jQuery.ajax({url:"/ajax/danmuSet.php",data:{sn:t.videoSn,content:e,color:t.danmucolor,position:t.danmuposition,size:t.danmusize,time:n,token:a},method:"POST",dataType:"json"}).done(function(a){if(a.error)return egg.lightbox.close(),void(a.nologin?egg.mutbox(a.msg," ",{"前往登入":function(){location.href="https://user.gamer.com.tw/login.php"}},{closeButton:!1,closeTrigger:"none"}):alert(a.msg));var o={text:e,color:t.danmucolor,size:t.danmusize,position:t.danmuposition,time:n};t.danmuInsert(o),t.refreshdanmu()})}))},a.prototype.accusedanmu=function(e){o().done(function(t){jQuery.ajax({url:"ajax/danmuAccuse.php?sn="+e,data:{sn:e,token:t},method:"POST",dataType:"json"}).done(function(t){t.error?alert(t.msg):jQuery("#danmu"+e).html("已完成檢舉！").css({color:"darkgray"})})})},a.prototype.enterkey=function(e){jQuery(".bullet_control").hide();var t=isIE()?e.keyCode:e.which;13==t&&(egg.lightbox.close(),this.setdanmu(jQuery("#danmutxt").val()),e.preventDefault?e.preventDefault():e.returnValue=!1)},a.prototype.danmustart=function(){jQuery("#danmu").danmu("danmuResume")},a.prototype.danmupause=function(){jQuery("#danmu").danmu("danmuPause")},a.prototype.danmusettime=function(e){jQuery("#danmu").danmu("setTime",10*parseInt(e))},a.prototype.checkdanmulist=function(e){e?(jQuery("#danmutxt").attr({placeholder:"",disabled:!1}),jQuery("#danmuturn").attr("disabled",!1),jQuery("#animeTip").hide()):(jQuery("#danmutxt").attr({placeholder:"系統預備中",disabled:!0}),jQuery("#danmuturn").attr("disabled",!0),jQuery("#animeTip").show());var t=animefun;if(!animefun.stopscroll){var n=animefun.danmu_time?animefun.danmu_time:0,a=0;for(var o in t.danmu)t.danmu[o].time<n&&t.danmu.length>a+2&&r(n)!==r(t.danmu[a+1].time)&&a++;var i=40*(a-1);jQuery("#sub_list").scrollTop(i)}},a.prototype.notSupportedMsg=function(t){if(egg.lightbox.close(),1!=t)if(egg.cookie.get("ckAndroid")||egg.cookie.get("ckiOS"))egg.mutbox("目前本服務不支援巴哈姆特APP，建議使用手機瀏覽器！"," ",{"好，我了解了":function(){egg.lightbox.close()}},{closeButton:!1});else{var n=navigator.userAgent.toLowerCase();if(-1!=n.indexOf("windows",0)&&1!=e.sessionStorage.getItem("ANIME_uatips")){var a,o=0;if(o=n.match(/chrome\/(\d+\.\d+)/)&&n.match(/safari\/(\d+\.\d+)/)?1:(a=n.match(/safari\/(\d+\.\d+)/))?8<a[1]?1:0:(a=n.match(/firefox\/(\d+\.\d+)/))?42<a[1]?1:0:(a=n.match(/opera\/(\d+\.\d+)/))?27<a[1]?1:0:(a=n.match(/msie (\d+\.\d+)/))?na.ie=10>=a[1]?0:11==a[1]&&-1!=n.indexOf("windows nt 6.2",0)?0:1:0,0==o){var r='<p style="margin:0 0 5px 0;">您的使用環境可能無法正常觀看動畫，請參考我們目前支援的使用環境！</p>';r+='<table width="100%">',r+="<tr>",r+='  <td width="25%" style="border:1px solid #c3c3c3;text-align:center;"></td>',r+='  <td style="border:1px solid #c3c3c3;text-align:center;">Chrome<br />全版本</td>',r+='  <td style="border:1px solid #c3c3c3;text-align:center;">Firefox<br />43.0 以上</td>',r+='  <td style="border:1px solid #c3c3c3;text-align:center;">IE<br />11 以上</td>',r+='  <td style="border:1px solid #c3c3c3;text-align:center;">Safari<br />8 以上</td>',r+="</tr>",r+="<tr>",r+='  <td style="border:1px solid #c3c3c3;text-align:center;">Windows XP</td>',r+='  <td style="border:1px solid #c3c3c3;text-align:center;font-weight:bold;">O</td>',r+='  <td style="border:1px solid #c3c3c3;text-align:center;">X</td>',r+='  <td style="border:1px solid #c3c3c3;text-align:center;">X</td>',r+='  <td style="border:1px solid #c3c3c3;text-align:center;">X</td>',r+="</tr>",r+="<tr>",r+='  <td style="border:1px solid #c3c3c3;text-align:center;">Windows 7</td>',r+='  <td style="border:1px solid #c3c3c3;text-align:center;font-weight:bold;">O</td>',r+='  <td style="border:1px solid #c3c3c3;text-align:center;font-weight:bold;">O</td>',r+='  <td style="border:1px solid #c3c3c3;text-align:center;">X</td>',r+='  <td style="border:1px solid #c3c3c3;text-align:center;font-weight:bold;">O</td>',r+="</tr>",r+="<tr>",r+='  <td style="border:1px solid #c3c3c3;text-align:center;">Windows 8 以上</td>',r+='  <td style="border:1px solid #c3c3c3;text-align:center;font-weight:bold;">O</td>',r+='  <td style="border:1px solid #c3c3c3;text-align:center;font-weight:bold;">O</td>',r+='  <td style="border:1px solid #c3c3c3;text-align:center;font-weight:bold;">O</td>',r+='  <td style="border:1px solid #c3c3c3;text-align:center;font-weight:bold;">O</td>',r+="</tr>",r+="</table>",egg.mutbox(r,'<span style="font-size:16px;">系統訊息</span>',{"好，我了解了":function(){e.sessionStorage.setItem("ANIME_uatips",1),egg.lightbox.close()}},{closeButton:!1}),egg.bahabox.option("width","550px")}}}},a.prototype.blackUid=function(e,t){egg.mutbox('往後將會看不到"'+e+'"的彈幕，請問是否確定？<br>(提示：被消音的對象可以在勇者小屋的黑名單功能中進行解除)',"消音",{"確定":function(n){egg.lightbox.close(),o().done(function(n){jQuery.ajax({url:"/ajax/blackUser.php",data:{fid:e,cno:0,token:n,vidoeSn:t},method:"POST",dataType:"json"}).done(function(e){e.error?egg.mutbox(e.msg," "):animefun.refreshdanmu()})})},"取消":egg.lightbox.close},{closeButton:!1})},a.prototype.setStorageItem=function(t,n){return i()?e.localStorage.setItem(t,n):!1},a.prototype.gettotaltime=function(){return i()?e.localStorage.getItem("ANIME_totalTime"):!1},a.prototype.hope=function(e,t,a){if(n==jQuery(e).find('[class="wish yes"]').get(0))var r=0;else var r=1;return o().done(function(n){jQuery.ajax({url:"/ajax/animeHope.php",data:{c1:t,c2:a,t:r,token:n},method:"POST",dataType:"json"}).done(function(t){egg.mutbox(t.msg," "),0==r?jQuery(e).find("[class=wish]").addClass("yes"):jQuery(e).find('[class="wish yes"]').removeClass("yes")})}),!1},a.prototype.bahablack=function(){return self=this,""==BAHAID?(egg.mutbox("請先登入"," ",{"前往登入":function(){location.href="https://user.gamer.com.tw/login.php"}},{closeButton:!0,closeTrigger:"none"}),void jQuery("#bahablack").prop("checked",!0)):void o().done(function(t){jQuery.ajax({url:"/ajax/animeBlack.php",data:{token:t},method:"GET",dataType:"json"}).done(function(t){if(t.error)egg.mutbox(t.msg," ");else{if(1==t.state){jQuery("#bahablack").addClass("baha_black_stop");var n="已停用過濾，您可能會看到不受歡迎的彈幕內容！"}else{jQuery("#bahablack").removeClass("baha_black_stop");var n="已開啟過濾，系統將自動隱藏不受歡迎的使用者與彈幕！"}self.refreshdanmu(),clearTimeout(u);var a=jQuery(e).width()-jQuery("#bahablack").offset().left-jQuery("#bahablack").width(),o=jQuery(e).height()-88;jQuery("#danmublackmsg").css("bottom",o+"px"),jQuery("#danmublackmsg").css("right",a+"px"),jQuery("#danmublackmsg").html(n).show(),u=setTimeout(function(){jQuery("#danmublackmsg").hide()},3e3)}})})},"object"==typeof exports?module.exports=a:"function"==typeof define&&define.amd?define("anime",[],function(){return a}):e.BAHA_ANIME=a}(window,window.document);var animefun=new BAHA_ANIME;
